{"version":"NotebookV1","origId":325513904363046,"name":"4.1L - Delta Live Tables","language":"sql","commands":[{"version":"CommandV1","origId":325513904363047,"guid":"607e929a-01c8-47b6-83f4-1b7a2a42163c","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n\n## Lab: implementing a DLT pipeline\n\n> This notebook is **not intended** to be executed interactively, but rather to be deployed as a DLT pipeline from the **workflows** tab\n\n\n* Help: <a href=\"https://docs.databricks.com/en/delta-live-tables/tutorial-sql.html\" target=\"_blank\">DLT syntax documentation</a>.","commandVersion":41,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d1b034eb-3ddd-4f6d-9e1e-d59478bd8d0e"},{"version":"CommandV1","origId":325513904363048,"guid":"80bfb1dc-c12e-4839-bd70-23b95584f1ed","subtype":"command","commandType":"auto","position":2.125,"command":"%md-sandbox\n\n<div  style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://raw.githubusercontent.com/derar-alhussein/Databricks-Certified-Data-Engineer-Associate/main/Labs/Includes/images/school_schema.png\" alt=\"School Schema\" style=\"width: 600\">\n</div>","commandVersion":2,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2d6d54cb-57f1-4bd0-92c4-c840a94281cb"},{"version":"CommandV1","origId":325513904363049,"guid":"7720c328-bceb-4d6a-8e96-40fd3830baec","subtype":"command","commandType":"auto","position":2.25,"command":"%md\n#### Q1- Declaring Bronze Tables\n\nDeclare a streaming live table, **`enrollments_bronze`**, that ingests JSON data incrementally using Auto Loader from the directory **\"${datasets_path}/enrollments-json-raw\"**","commandVersion":27,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7360706e-19b2-40a1-b895-417cf0f54229"},{"version":"CommandV1","origId":325513904363050,"guid":"b5b61d89-5cbc-425f-a892-b717eb4f4696","subtype":"command","commandType":"auto","position":2.625,"command":"CREATE ____________________\nAS SELECT * FROM cloud_files(\"${dataset_path}/enrollments-json-raw\", \"json\",\n                             map(\"cloudFiles.inferColumnTypes\", \"true\"))","commandVersion":40,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"35cb4e74-cf57-4fea-8a79-0b12f3938a4b"},{"version":"CommandV1","origId":325513904363051,"guid":"10263ba9-643a-4316-9f65-c792942b5423","subtype":"command","commandType":"auto","position":2.71875,"command":"%md\nDeclare a live table, **`students_bronze`**, that load data directly from JSON files in the directory **\"${datasets_path}/students-json\"**","commandVersion":21,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"82b03230-8b27-4efa-9613-987f90ac775b"},{"version":"CommandV1","origId":325513904363052,"guid":"0001760f-55d1-4bc5-b0d2-eb57d9640fdb","subtype":"command","commandType":"auto","position":2.8125,"command":"CREATE ____________________\nAS SELECT * FROM json.`${dataset_path}/students-json`","commandVersion":20,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2f7a23d2-a340-499f-a7bd-dea1cb881528"},{"version":"CommandV1","origId":325513904363053,"guid":"515049bd-6b20-4bc2-9701-9f3eb3627c7b","subtype":"command","commandType":"auto","position":2.90625,"command":"%md\n#### Q2 - Declaring Silver Table\n\nDeclare a streaming live table, **`enrollments_cleaned`**, that:\n\n1. Enrich the **enrollments_bronze** data through an inner join with the **`students_bronze`** table on the common **`student_id`** field to obtain the student's country\n1. Implement quality control by applying a constraint to drop records with a null **`email`**\n1. The table will have the following schema:\n\n| Field | Type |\n| --- | --- |\n| **`enroll_id`** | **`STRING`** |\n| **`total`** | **`DOUBLE`** |\n| **`email`** | **`STRING`** |\n| **`country`** | **`STRING`** |\n","commandVersion":111,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5f67b1c4-34b0-4b19-8f58-fc475fcc74ec"},{"version":"CommandV1","origId":325513904363054,"guid":"8651caf4-cbce-48b1-a40c-e9a4ab80e771","subtype":"command","commandType":"auto","position":2.953125,"command":"CREATE OR REFRESH STREAMING LIVE TABLE enrollments_cleaned\n  (CONSTRAINT ____________________ ON VIOLATION ____________________ )\nAS SELECT enroll_id, total, email, profile:address:country as country\n  FROM ____________________ n\n  INNER ____________________ s\n    ON n.student_id = s.student_id","commandVersion":114,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"eb4f340f-898b-423b-b632-5b8002364e24"},{"version":"CommandV1","origId":325513904363055,"guid":"4a3a3093-00c6-4ca4-ad4b-3d355658fb94","subtype":"command","commandType":"auto","position":2.9765625,"command":"%md\n### Q3- Declaring Gold Table\n\nDeclare a live table, **`course_sales_per_country`** against **`enrollments_cleaned`** that calculate per **`country`** the following:\n* **`enrollments_count`**: the number of enrollments\n* **`enrollments_amount`**: the sum of the total amount of enrollments\n\nAdd a comment to the table: \"Course Sales Per Country\"","commandVersion":110,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"77194f04-e07c-4b5d-a77b-44c0186bab7f"},{"version":"CommandV1","origId":325513904363056,"guid":"276cf30f-06ac-4077-b007-292f06a1e327","subtype":"command","commandType":"auto","position":2.98828125,"command":"CREATE OR REFRESH LIVE TABLE course_sales_per_country\n  COMMENT ____________________\nAS SELECT ____________________\n","commandVersion":51,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2ef50552-e590-48ff-b347-7effb22ce501"},{"version":"CommandV1","origId":325513904363057,"guid":"c4097f3d-b88d-458a-a35d-12cf8592ff2e","subtype":"command","commandType":"auto","position":3.98828125,"command":"%md\n### Q4- Deploying DLT pipeline\n\nFrom the **Workflows** button on the sidebar, under the **Delta Live Tables** tab, click **Create Pipeline**\n\nConfigure the pipeline settings specified below:\n\n| Setting | Instructions |\n|--|--|\n| Pipeline name | School DLT |\n| Product edition | Choose **Advanced** |\n| Pipeline mode | Choose **Triggered** |\n| Source code | Use the navigator to select this current notebook (4.1L - Delta Live Tables) |\n| Storage location | dbfs:/mnt/DE-Associate/dlt/school |\n| Target schema | DE_Associate_School_DLT |\n| Cluster policy | Leave it **None**|\n| Cluster mode | Choose **Fixed size**|\n| Workers | Enter **0**|\n| Photon Acceleration | Leave it unchecked |\n| Advanced Configuration | Click **Add Configuration** and enter:<br> - Key: **dataset_path** <br> - Value: **dbfs:/mnt/DE-Associate/datasets/school** |\n| Channel | Choose **Current**|\n\nFinally, click **Create**.","commandVersion":118,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8206436a-a87e-4682-bef8-3a92c8605a4c"},{"version":"CommandV1","origId":325513904363058,"guid":"d3cb2650-bc41-4874-934e-ae8c390442e9","subtype":"command","commandType":"auto","position":4.98828125,"command":"%md\n### Q5 - Run your Pipeline\n\nSelect **Development** mode and Click **Start** to begin the update to your pipeline's tables","commandVersion":27,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ed8136b4-3967-4fbb-825d-86c5dcf6f376"}],"dashboards":[],"guid":"1e48f537-0aa9-4466-a06c-35fa29f11c3c","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}